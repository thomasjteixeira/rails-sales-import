#!/usr/bin/env bash

echo "ğŸš€ Starting deployment setup..."

# Ensure storage directory exists
echo "ğŸ“ Ensuring storage directory exists..."
mkdir -p /opt/render/project/src/storage

# Create database if it doesn't exist and migrate
echo "ğŸ—„ï¸ Setting up database..."
bundle exec rails db:prepare

# Check if database has data, if not seed it
echo "ğŸŒ± Checking if database needs seeding..."
if bundle exec rails runner "exit(SalesImport.count > 0 ? 0 : 1)" 2>/dev/null; then
  echo "âœ… Database already has data, skipping seed"
else
  echo "ğŸŒ± Database is empty, seeding with sample data..."
  bundle exec rails db:seed
  echo "âœ… Database seeded successfully!"
fi

echo "ğŸ‰ Deployment setup completed!"
